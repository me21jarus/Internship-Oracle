<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Siebel Component Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 2rem;
            background: #f9fafb;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 2rem;
            color: #111827;
        }

        .dashboard-container {
            display: flex;
            width: 100%;
            max-width: 1400px;
            gap: 1.5rem;
            transition: all 0.5s ease;
        }

        .dashboard {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            flex: 1;
            transition: all 0.5s ease;
        }

        .dashboard.shrink {
            flex: 0 0 70%;
        }

        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            padding: 1.5rem;
            width: 300px;
            cursor: pointer;
            transition: all 0.4s ease;
        }

        .card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.1);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .status-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid #e5e7eb;
        }

        .beam {
            height: 10px;
            border-radius: 5px;
            margin-top: 0.75rem;
            transition: width 0.5s ease-in-out, background-color 0.5s ease-in-out;
        }

        .footer {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #6b7280;
            margin-top: 0.75rem;
        }

        .details-pane {
            flex: 0 0 30%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            padding: 1.5rem;
            display: none;
            flex-direction: column;
            position: relative;
        }

        .details-pane.active {
            display: flex;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab {
            padding: 0.5rem 1rem;
            margin-right: 0.5rem;
            background: #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
        }

        .tab.active {
            background: #2563eb;
            color: white;
        }

        .logs {
            margin-top: 1rem;
            max-height: 200px;
            overflow-y: auto;
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 10px;
            font-size: 0.85rem;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f87171;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.25rem 0.75rem;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .export-btn {
            background-color: #2563eb;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            border: none;
            font-size: 0.9rem;
            margin-top: 1rem;
            width: 100%;
            transition: background-color 0.3s ease;
        }

        .export-btn:hover {
            background-color: #1d4ed8;
        }

        .search-bar,
        .filter-bar {
            margin-bottom: 1.5rem;
            width: 100%;
            max-width: 400px;
            display: flex;
            gap: 0.5rem;
            justify-content: space-between;
        }

        .search-bar input,
        .filter-bar select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            font-size: 1rem;
        }

        .email-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(to right, #6366f1, #3b82f6);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            transition: background-color 0.3s ease;
            border: none;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        }

        .email-btn:hover {
            background-color: #1d4ed8;
        }

        .email-btn:focus {
            outline: none;
        }

        .search-filter-container {
            display: flex;
            gap: 1rem;
            align-items: center;
            width: 100%;
            max-width: 800px;
        }

        .search-bar input,
        .filter-bar select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            font-size: 1rem;
        }

        .notification-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ef4444;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }

        .notification-badge.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Email settings modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            width: 450px;
            max-width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            font-size: 1rem;
        }

        .save-btn {
            background-color: #2563eb;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            border: none;
            font-size: 1rem;
            width: 100%;
            transition: background-color 0.3s ease;
        }

        .save-btn:hover {
            background-color: #1d4ed8;
        }

        .settings-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2563eb;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            border: none;
            font-size: 1.25rem;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>

<body>
    <h1><i class="fas fa-server"></i> Siebel Component Monitoring Dashboard</h1>
    <!-- Search and Filter Section -->
    <div class="search-filter-container">
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search Components" oninput="filterComponents()">
        </div>
        <div class="filter-bar">
            <select id="statusFilter" onchange="filterComponents()">
                <option value="">Filter by Status</option>
                <option value="Online">Online</option>
                <option value="Warning">Warning</option>
                <option value="Offline">Offline</option>
            </select>
        </div>
    </div>

    <div class="dashboard-container">
        <div class="dashboard" id="dashboard"></div>
        <div class="details-pane" id="detailsPane">
            <button class="close-btn" onclick="closeDetails()">Close</button>
            <h2 id="detailTitle">Component Details</h2>
            <div>
                <span class="tab active" onclick="switchTab('logs', event)">Logs</span>
                <span class="tab" onclick="switchTab('info', event)">Info</span>
            </div>
            <div class="logs" id="logContent"></div>
            <canvas id="trendGraph" style="width: 100%; height: 200px; margin-top: 1rem;"></canvas>
            <button class="export-btn" onclick="exportToPDF()">Export to PDF</button>
            <br>
            <button onclick="emailComponentDetails()" class="email-btn">
                📧 Email Report
            </button>
            <br>
            <button onclick="emailComponentDetails()" class="email-btn">
                Notify in JIRA
            </button>
        </div>
    </div>

    <!-- Notification Badge -->
    <div class="notification-badge" id="notificationBadge">
        Component status changed to Offline!
    </div>

    <!-- Settings Button -->
    <button class="settings-btn" id="settingsBtn" onclick="openEmailSettings()">
        ⚙️
    </button>

    <!-- Email Settings Modal -->
    <div class="modal" id="emailSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Alert Settings</h3>
                <button class="modal-close" onclick="closeEmailSettings()">&times;</button>
            </div>
            <div class="form-group">
                <label for="alertEmail">Email Address</label>
                <input type="email" id="alertEmail" placeholder="Enter your email address">
            </div>
            <div class="form-group">
                <label for="alertThreshold">Alert Threshold</label>
                <select id="alertThreshold" class="form-control">
                    <option value="Warning,Offline">Any issue (Warning or Offline)</option>
                    <option value="Offline">Critical issues only (Offline)</option>
                </select>
            </div>
            <button class="save-btn" onclick="saveEmailSettings()">Save Settings</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const components = [
            "Business Integration Batch Manager",
            "Business Integration Manager",
            "Call Center Object Manager (ENU)",
            "Custom Application Object Manager (ENU)",
            "Data Manager",
            "Workflow Process Manager",
            "EAI Object Manager",
            "Email Manager",
            "Mobile Web Client Object Manager",
            "Siebel Server"
        ];

        const statusMap = {
            Online: { color: '#10b981', width: '100%', icon: 'fas fa-check-circle' },
            Warning: { color: '#facc15', width: '60%', icon: 'fas fa-exclamation-circle' },
            Offline: { color: '#ef4444', width: '25%', icon: 'fas fa-times-circle' },
        };

        const dummyLogs = [
            "Failed to connect to database.",
            "Component restarted successfully.",
            "Health check passed.",
            "Configuration mismatch detected.",
            "No recent activity detected.",
            "Unexpected termination of process.",
        ];

        // Store component status history for monitoring changes
        const componentStatusHistory = {};
        
        // Email settings - using variables instead of localStorage due to sandbox restrictions
        let alertEmail = '';
        let alertThreshold = 'Warning,Offline';

        function getRandomStatus() {
            const keys = Object.keys(statusMap);
            return keys[Math.floor(Math.random() * keys.length)];
        }

        function updateStatus(card, status) {
            const componentName = card.querySelector('h3').textContent;
            const previousStatus = card.dataset.status;
            const dot = card.querySelector('.status-dot');
            const beam = card.querySelector('.beam');
            const label = card.querySelector('.status-label');
            const icon = card.querySelector('.status-icon');

            dot.style.backgroundColor = statusMap[status].color;
            beam.style.backgroundColor = statusMap[status].color;
            beam.style.width = statusMap[status].width;
            label.textContent = status;
            icon.className = `status-icon ${statusMap[status].icon}`;
            icon.style.color = statusMap[status].color;

            card.dataset.status = status;

            // Check if status changed from a better state to a worse state
            if ((previousStatus === 'Online' && (status === 'Warning' || status === 'Offline')) || 
                (previousStatus === 'Warning' && status === 'Offline')) {
                
                // Check if this status should trigger an alert
                const thresholdStatuses = alertThreshold.split(',');
                if (thresholdStatuses.includes(status)) {
                    showNotification(`Component ${componentName} status changed to ${status}!`);
                    
                    // Send email alert if email is configured
                    if (alertEmail) {
                        sendAlertEmail(componentName, status);
                    }
                }
            }

            // Store the status change
            if (!componentStatusHistory[componentName]) {
                componentStatusHistory[componentName] = [];
            }
            componentStatusHistory[componentName].push({
                status: status,
                timestamp: new Date()
            });

            // 🔁 Reapply the filter on status change
            filterComponents();
        }

        function showNotification(message) {
            const notification = document.getElementById('notificationBadge');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        function sendAlertEmail(componentName, status) {
            const timestamp = new Date().toLocaleString();
            
            const subject = encodeURIComponent(`ALERT: Siebel Component Status Change - ${componentName}`);
            const body = encodeURIComponent(
                `ALERT: Component Status Change Detected\n\n` +
                `Component: ${componentName}\n` +
                `New Status: ${status}\n` +
                `Time of Change: ${timestamp}\n\n` +
                `Please check the Siebel Component Monitoring Dashboard for more details.\n\n` +
                `This is an automated message from your Monitoring System.`
            );

            // In a real application, you would use a server-side API to send emails
            // For this demo, we'll just open the mail client
            if (alertEmail) {
                window.location.href = `mailto:${alertEmail}?subject=${subject}&body=${body}`;
            }
            
            console.log(`Alert email sent to ${alertEmail} for component ${componentName} status ${status}`);
        }

        function emailComponentDetails() {
            const componentName = document.getElementById('detailTitle').textContent;
            const timestamp = new Date().toLocaleString();
            const pdfLink = window.location.origin + `/exports/${componentName}_Details.pdf`; // adjust path accordingly

            const subject = encodeURIComponent(`Siebel Component Report: ${componentName}`);
            const body = encodeURIComponent(
                `Hi,\n\nPlease find below the report for the component: ${componentName}\n\n` +
                `📅 Generated On: ${timestamp}\n` +
                `📄 View/Download PDF Report: ${pdfLink}\n\n` +
                `Thanks,\nYour Monitoring Dashboard`
            );

            const recipient = alertEmail || '';
            window.location.href = `mailto:${recipient}?subject=${subject}&body=${body}`;
        }

        function showDetails(name) {
            const pane = document.getElementById('detailsPane');
            const dashboard = document.querySelector('.dashboard');

            // Re-trigger fade-in animation
            pane.classList.remove('fade-in');
            void pane.offsetWidth;
            pane.classList.add('fade-in');

            pane.classList.add('active');
            dashboard.classList.add('shrink');
            document.getElementById('detailTitle').textContent = name;

            const logs = Array.from({ length: 5 }, () => dummyLogs[Math.floor(Math.random() * dummyLogs.length)]);
            document.getElementById('logContent').innerHTML = logs.map(log => `<div>• ${log}</div>`).join('');

            renderGraph();
        }

        function closeDetails() {
            document.getElementById('detailsPane').classList.remove('active', 'fade-in');
            document.querySelector('.dashboard').classList.remove('shrink');
        }

        function switchTab(tab, event) {
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            if (tab === 'logs') {
                document.getElementById('logContent').innerHTML = dummyLogs.map(log => `<div>• ${log}</div>`).join('');
            } else {
                document.getElementById('logContent').innerHTML = `
          <div>Version: 23.2.1</div>
          <div>Last Checked: ${new Date().toLocaleString()}</div>
          <div>Uptime: ${Math.floor(Math.random() * 1000)} hours</div>
        `;
            }
        }

        function createCard(name, status) {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.status = status; // Store the status for filtering
            card.innerHTML = `
        <div class="header">
          <h3 style="margin:0; font-size: 1.05rem">${name}</h3>
          <div class="status-dot"></div>
        </div>
        <div class="footer">
          <i class="status-icon"></i>
          <span>Status: <span class="status-label"></span></span>
        </div>
        <div class="beam"></div>
      `;
            updateStatus(card, status);
            card.addEventListener('click', () => showDetails(name));
            document.getElementById("dashboard").appendChild(card);

            // Set interval to 10-15 minutes (600000-900000 ms) instead of 4-5 seconds
            setInterval(() => {
                updateStatus(card, getRandomStatus());
            }, 600000 + Math.random() * 300000); // Random between 10-15 mins
        }

        components.forEach(name => {
            const status = getRandomStatus();
            createCard(name, status);
        });

        function renderGraph() {
            const ctx = document.getElementById('trendGraph').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May'],
                    datasets: [{
                        label: 'Component Status',
                        data: [12, 19, 3, 5, 2],
                        fill: false,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const marginLeft = 15;
            let y = 20;

            // Title
            const componentName = document.getElementById('detailTitle').textContent;
            doc.setFontSize(18);
            doc.setTextColor(33, 37, 41);
            doc.text(`Component Report: ${componentName}`, marginLeft, y);
            y += 10;

            // Divider
            doc.setLineWidth(0.5);
            doc.line(marginLeft, y, 195, y);
            y += 10;

            // Logs Section
            doc.setFontSize(14);
            doc.setTextColor(52, 58, 64);
            doc.text("🔍 Logs", marginLeft, y);
            y += 8;

            const logsHTML = document.getElementById('logContent').innerHTML;
            const logLines = logsHTML
                .replace(/<div>/g, '')
                .replace(/<\/div>/g, '')
                .split('•')
                .map(line => line.trim())
                .filter(Boolean);

            doc.setFontSize(11);
            doc.setTextColor(66, 66, 66);
            logLines.forEach((log, index) => {
                const lines = doc.splitTextToSize(`• ${log}`, 180);
                doc.text(lines, marginLeft, y);
                y += lines.length * 6;
            });

            y += 5;

            // Trend Graph Section
            doc.setFontSize(14);
            doc.setTextColor(52, 58, 64);
            doc.text("📈 Trend Graph", marginLeft, y);
            y += 8;

            const graphCanvas = document.querySelector('canvas');
            if (graphCanvas) {
                const graphDataUrl = graphCanvas.toDataURL('image/png');
                const graphHeight = 70;
                const graphWidth = 180;
                if (y + graphHeight > 280) {
                    doc.addPage();
                    y = 20;
                }
                doc.addImage(graphDataUrl, 'PNG', marginLeft, y, graphWidth, graphHeight);
                y += graphHeight + 10;
            }

            // Footer
            doc.setFontSize(10);
            doc.setTextColor(120, 120, 120);
            doc.text(`Generated on: ${new Date().toLocaleString()}`, marginLeft, 290);

            doc.save(`${componentName}_Details.pdf`);
        }

        function filterComponents() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;

            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                const cardName = card.querySelector('h3').textContent.toLowerCase();
                const cardStatus = card.dataset.status;
                const matchesSearch = cardName.includes(searchText);
                const matchesStatus = statusFilter ? cardStatus === statusFilter : true;

                if (matchesSearch && matchesStatus) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Email settings modal functions
        function openEmailSettings() {
            document.getElementById('emailSettingsModal').style.display = 'flex';
            document.getElementById('alertEmail').value = alertEmail;
            document.getElementById('alertThreshold').value = alertThreshold;
        }

        function closeEmailSettings() {
            document.getElementById('emailSettingsModal').style.display = 'none';
        }

        function saveEmailSettings() {
            alertEmail = document.getElementById('alertEmail').value;
            alertThreshold = document.getElementById('alertThreshold').value;
            
            // Simply store in variables - no localStorage due to sandbox restrictions
            
            showNotification('Alert settings saved successfully!');
            closeEmailSettings();
        }

        // For demo purposes - add a quick status change button
        // This allows testing the alert functionality without waiting for the timed interval
        document.addEventListener('DOMContentLoaded', function() {
            // Add a hidden debug button to test faster status changes (press Alt+D to activate)
            document.addEventListener('keydown', function(e) {
                if (e.altKey && e.key === 'd') {
                    // Force status change on a random component
                    const cards = document.querySelectorAll('.card');
                    const randomCard = cards[Math.floor(Math.random() * cards.length)];
                    updateStatus(randomCard, 'Offline');
                    showNotification('Debug: Forced a status change to test alerts');
                }
            });
        });
    </script>
</body>

</html>